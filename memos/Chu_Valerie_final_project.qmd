---
title: "An Analysis of Avocados"
subtitle: |
  | Final Project 
  | Data Science 2 with R (STAT 301-2)
author: "Valerie Chu"
date: today

format:
  html:
    toc: true
    embed-resources: true
    
execute:
  warning: false

from: markdown+emoji 
reference-location: margin
citation-location: margin
---

::: {.callout-tip icon=false}

## Github Repo Link

[https://github.com/stat301-2-2024-winter/final-project-2-valerieyichu.git](https://github.com/stat301-2-2024-winter/final-project-2-valerieyichu.git)

:::


```{r}
#| echo: false

# load packages
library(tidyverse)
library(tidymodels)
library(here)

# handle common conflicts
tidymodels_prefer()

```


```{r, echo = FALSE}
# Read in the avocado dataset
avocado <- read_csv(here("data/avocado.csv")) |> 
  janitor::clean_names()

```

## Introduction

I'm Californian, and avocados are a big thing. There's avocado toast, avocado spread, avocado in salad, and much more. That's why I was interested in a dataset about avocados. Hopefully, this final project will help me pinpoint and eventually move to a city with the cheapest avocados...


## Data Overview

This dataset contains historical data on avocado prices and sales volume in multiple US markets.

This is the link to the Avocado Prices dataset on Kaggle:
**[https://www.kaggle.com/datasets/neuromusic/avocado-prices](https://www.kaggle.com/datasets/neuromusic/avocado-prices)** ^[Kiggins, Justin. "Avocado Prices." Kaggle, 2018, https://www.kaggle.com/datasets/neuromusic/avocado-prices.]

This data was downloaded from the Hass Avocado Board website ^[Hass Avocado Board, https://hassavocadoboard.com/] in May of 2018 and compiled into a single CSV. There are 18,249 observations in this dataset and 14 variables. There is 1 date-time object, 10 numerical variables, 2 categorical variables and 1 id column. There is no missingness in this dataset. 

**I want to predict the prices avocados will sell at (ie. `average_price`).** So this is a **regression problem**. 

These are the definitions for some of the variables: 

- `date` - The date of the observation

- `average_price` - the average price of a single avocado

- `type` - conventional or organic

- `year` - the year

- `region` - the city or region of the observation

- `total_volume` - Total number of avocados sold

- `x4046` - Total number of avocados with PLU 4046 sold

- `x4225` - Total number of avocados with PLU 4225 sold

- `x4770` - Total number of avocados with PLU 4770 sold


## Methods

This is a regression problem, so the assessment metric I will be using is the RMSE. RMSE calculates the average difference between the model's predicted prices and the actual prices, and it better accounts for outliers, which is important since a preliminary exploration of average price reveals that this variable is slightly skewed right. 

Because this dataset is quite large, at 18,249 observations, I decided to use 70% of this dataset to train the model (12,772 observations) and 30% to test the model (5,477 observations). 

I also resampled my dataset, partitioning the dataset into 10 parts and repeating this 5 more times. Training the model like this across multiple subsets of data lets us measure the average performance across all these partitions. This lets us better quantify the variability of our data and get better estimates, while also preventing overfitting. So 1,277 observations will be in the assessment set and 11,494 observations will be in the training set.  

I used these models: Null (baseline model), OLS, Lasso, Ridge, Boosted Tree, K Nearest Neighbors, and Random Forest. 

I will be using a kitchen sink recipe and a feature engineered recipe. 

For the kitchen sink recipes, my goal was to create a very simple, general recipe. I started by predicting the target variable with all other variables. I removed the id, date time, and categorical variables. I filtered out variables with zero variance. Then I centered and scaled all predictors. 

I decided on my feature engineered recipes based on my exploratory data analysis of the target variable, average price, as well as other variables in the dataset. 

- There are only 9 numeric variables, and since the correlation between all of them ??????????? was quite strong, I kept them all in. 

- Once again, I removed the id, date time, and categorical variables, but this time, I kept in `type` (see Appendix A: there are only 2 types of avocados - conventional and organic - so it makes sense to dummy `type`). 

- This time, I added interaction terms. There is an interaction term between the type of avocado and the total number of avocados sold, because especially with the rise of an organic-conscious craze in recent years, I was curious about whether the type of avocado has an effect on the total number of avocados sold. 

A few additional notes on my feature engineered recipes: 

- There is no missingness in my data, so I don't need to impute. 

- Avocado prices and bag numbers tend to be within a similar range, so there's no need to log transform. 

- CHECK FOR SPLINES ????

## Model Building & Selection




## Final Model Analysis

The table of RMSEs and standard errors created below was made using kitchen recipes. It displays the RMSE and standard error for the model with the lowest RMSE for each model type.

The baseline is the null model. I've also defined and fitted the OLS, Lasso, Ridge, Boosted Tree, K Nearest Neighbors, and Random Forest models. 

```{r, echo = FALSE}
load(here("results/tbl_result.rda"))
tbl_result |> 
  knitr::kable()

```

The best model is the random forest model because it has the lowest RMSE. It also has a low standard error. So the predictions created by the random forest model should be the closest to the true values.

### EDA

Next, I will do a preliminary EDA to continue on the progress made in Progress Memo 1. This will help decide what interactions to use in my second recipe. 

Below is a correlation plot.

```{r, echo = FALSE}
avocado |> 
  select(average_price, total_volume, x4046, x4225, x4770, total_bags, 
         small_bags, large_bags, x_large_bags) |> 
  cor() |> 
  knitr::kable()
```
It seems like for my second recipe, I could create interactions between `total_bags` and `small_bags`, `total_volume` and `x4046`, and `total_volume` and `x4225`. (As a reminder, 4046 and 4225 are PLU numbers â€” numbers used to properly identify avocados sold at retail.)


## Conclusion

## How it's going

I've split and folded the data; created a kitchen sink recipe; and fitted null, OLS, lasso, ridge, boosted tree, k nearest neighbors, and random forest models; and found the RMSE and standard error for the model with the lowest RMSE for each model type. Right now, I don't have any potential issues or concerns. 

Moving forward, I plan to conduct a more comprehensive EDA than the one I did for Progress Memo 1 so that I can determine what interaction terms I should use for my second recipe, and I will tune and fit my other models accordingly so that I can determine the best model overall. 

## References


## Appendix A: An exploration of average avocado price 

Our check for missingness reveals that there is none in this dataset. 

```{r}
#| echo: false

naniar::gg_miss_var(avocado)

```

A skim of this dataset also confirms this. 
```{r}
#| echo: false

skimr::skim(avocado)

```

Let's explore the variable `average_price`. 

```{r}
#| echo: false

avocado |> 
  ggplot(aes(x = average_price)) +
  geom_boxplot() +
  scale_x_continuous(breaks = seq(0, 4, 0.5)) +
  theme_minimal()

```

The median `average_price` of an avocado in this dataset is $1.37. The IQR is about $0.56. This boxplot is slightly right skewed, but not to the extreme that it would warrant any logarithmic transformations. There are several outliers for `average_price`, with these outliers spanning the $2.50 to $3.25 per avocado range. The cheapest average price of an avocado is $0.44. The most expensive average price of an avocado is $3.25.

```{r}
#| echo: false

avocado |> 
  select(average_price) |> 
  summary(mean = mean(average_price, na.rm = TRUE),
          median = median(average_price, na.rm = TRUE)) |> 
  knitr::kable()

```

A correlation plot:
```{r}
#| echo: false

avocado |> 
  select(average_price, total_volume, x4046, x4225, x4770, 
         total_bags, small_bags, large_bags,  x_large_bags) |> 
  cor() |> 
  knitr::kable()

```


